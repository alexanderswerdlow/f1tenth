<launch>
	<arg name="IS_TWISTSTAMPED" default="true"/>
	<arg name="publish_covariance" default="false"/>

	<param name="/use_sim_time" value="true"/>
	<param name="/stamped_vel" value="$(arg IS_TWISTSTAMPED)"/>

	<node name="scans_demo" pkg="rosbag" type="play" output="screen"
		  args="-r 1 -s 2 -u 100 --clock  /home/aswerdlow/Documents/logs/_2018-07-26-15-49-45.bag "/>

	<node pkg="path_control" type="highlevel_dummy" name="highlevel_dummy" output="screen" respawn="true">
		<param name="target_speed" value="1.0"/>
		<param name="failure_mode" value="replan"/>
		<remap from="rviz_goal" to="/move_base_simple/goal"/>
	</node>

	<!-- <include file="$(find navigation_launch)/launch/navigation.launch">
		<arg name="use_laser_obstacles" value="true"/>

		<arg name="use_karto" value="false"/>
		<arg name="use_karto_segmented" value="false"/>
		<arg name="use_amcl" value="false"/>
		<arg name="use_hector" value="false"/>

		<arg name="use_planner_cost" value="false"/>
		<arg name="use_planner_dynamic" value="false"/>
		<arg name="use_planner_static" value="false"/>
		<arg name="use_planner_goal" value="false"/>
		<arg name="use_planner_default" value="true"/>

	</include>
		<param name="path_follower/local_planner/algorithm" value="NULL"/>
	-->

	<!-- move base -->
	<node pkg="move_base" type="move_base" respawn="false" name="move_base_node">
		<!-- params for move_base -->
		<param name="planner_frequency" value="2"/>
		<param name="controller_frequency" value="10.0"/>
		<param name="controller_patience" value="3.0"/>
		<param name="oscillation_timeout" value="30.0"/>
		<param name="oscillation_distance" value="0.5"/>
		<!-- params for local control (dwa) -->
		<param name="base_local_planner" value="dwa_local_planner/DWAPlannerROS"/>
		<rosparam file="$(find hypha_racecar)/launch/Simulation/includes/dwa_local_planner_params.yaml" command="load"/>
		<!-- params for costmap layers -->
		<rosparam file="$(find hypha_racecar)/launch/Simulation/includes/local_costmap_params.yaml" command="load"/>
		<rosparam file="$(find hypha_racecar)/launch/Simulation/includes/global_costmap_params.yaml" command="load"/>
	</node>



	<include file="$(find race)/params/tf.launch"/>

	<include file="$(find race)/params/rf2o_config.launch"/>

	<node pkg="robot_localization" type="ekf_localization_node" name="ekf_se" clear_params="true">
		<rosparam command="load" file="$(find race)/params/ekf_params.yaml"/>
	</node>

	<!-- gmapping -->
	<node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
		<remap from="scan" to="scan"/>
		<param name="map_update_interval" value="0.5"/>
		<param name="maxUrange" value="16.0"/>
		<param name="sigma" value="0.05"/>
		<param name="kernelSize" value="1"/>
		<param name="lstep" value="0.05"/>
		<param name="astep" value="0.05"/>
		<param name="iterations" value="5"/>
		<param name="lsigma" value="0.075"/>
		<param name="ogain" value="3.0"/>
		<param name="lskip" value="0"/>
		<param name="srr" value="0.1"/>
		<param name="srt" value="0.2"/>
		<param name="str" value="0.1"/>
		<param name="stt" value="0.2"/>
		<param name="linearUpdate" value="0.1"/>
		<param name="angularUpdate" value="0.01"/>
		<param name="temporalUpdate" value="3.0"/>
		<param name="resampleThreshold" value="0.25"/>
		<param name="particles" value="10"/>
		<param name="xmin" value="-50.0"/>
		<param name="ymin" value="-50.0"/>
		<param name="xmax" value="50.0"/>
		<param name="ymax" value="50.0"/>
		<param name="delta" value="0.05"/>
		<param name="llsamplerange" value="0.01"/>
		<param name="llsamplestep" value="0.01"/>
		<param name="lasamplerange" value="0.005"/>
		<param name="lasamplestep" value="0.005"/>
		<param name="odom_frame" value="odom"/>
		<param name="base_frame" value="base_link"/>
	</node>


	<node pkg="hypha_racecar" type="L1_controller_v2" respawn="false" name="L1_controller_v2" output="screen">
		<!-- L1 -->
		<param name="Vcmd" value="1.0" /> <!-- speed of car m/s -->
		<!-- ESC -->
		<param name="baseSpeed" value="1425"/> <!-- pwm for motor constant speed, 1480: stop, 1440: ~0.5m/s, 1430: ~1.5m/s -->
		<!-- Servo -->
		<param name="baseAngle" value="90.0"/> <!-- the middle pos of servo, for tt02: 87, for hsp: ? -->
		<param name="AngleGain" value="-3.5"/> <!-- for tt02: >0, for hsp: <0 -->

		<!-- remap from="/odometry/filtered" to="odom" / -->
		<remap from="/move_base_node/NavfnROS/plan" to="/move_base/NavfnROS/plan" />
	</node>

	<node name="rviz" pkg="rviz" type="rviz" args="-d $(find hypha_racecar)/rviz_cfg/hypha_stage_sim.rviz"/>
	<!--Localization using Laser Scan Matcher
	<group if="$(arg publish_covariance)">
		<param name="laser_scan_matcher_node/do_compute_covariance" value="1"/>
		<param name="laser_scan_matcher_node/publish_pose_with_covariance" value="true"/>
		<param name="laser_scan_matcher_node/publish_pose_with_covariance_stamped" value="true"/>
	</group>
	<node pkg="laser_scan_matcher" type="laser_scan_matcher_node"
		  name="laser_scan_matcher_node" output="screen">
		<remap from="imu" to="imu/data"/>
		<param name="use_odom" value="false"/>
		<param name="max_iterations" value="10"/>
	</node> -->
	<!-- <node name="map_to_scanner_base" pkg="tf2_ros" type="static_transform_publisher" args="0 0 0 0 0 0 map robot"/>
	<include file="$(find obstacle_detector)/launch/demo.launch"/> -

	<node pkg="rviz" type="rviz" name="rviz1" args="-d $(find hector_mapping)/rviz_cfg/mapping_demo.rviz"/>-->

	<!--<node name="rviz" pkg="rviz" type="rviz" output="screen"
		  args="-d $(find obstacle_detector)/resources/obstacle_detector.rviz"/> -->
	<!--<node pkg="rviz" type="rviz" name="rviz" args="-d $(find laser_scan_matcher)/demo/demo.rviz"/> -->

	<!--<node pkg="rqt_graph" type="rqt_graph" name="rqt_graph"/> -->

</launch>
